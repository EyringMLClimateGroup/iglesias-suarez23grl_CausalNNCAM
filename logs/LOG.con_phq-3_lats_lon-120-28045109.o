# pipeline
# cfg_pipeline.yml
---
documentation:
  description: Options (specifications) for the "pipeline" script.

  authors:
    - solino-fernandez_breixo
    - iglesias-suarez_fernando

  maintainer:
    - solino-fernandez_breixo
    - iglesias-suarez_fernando

  references:
    - acknow_project

  projects:
    - usmile


# # Specifications
# analysis       : 'single' # 'single': gridpoints individually; 
#                           # 'concat': gridpoints contatenated into a 
#                           #           single time-series; 
# spcam_parents  : ['tbp','qbp','vbp','ps','solin','shflx','lhflx']
# #spcam_parents  : ['tbp','ps']
# #spcam_children : ['tphystnd','phq','prect','fsns','flns','fsnt','flnt']
# spcam_children : ['tphystnd','phq','fsns','flns','fsnt','flnt']
# #spcam_children : ['tphystnd']
# pc_alphas      : [0.001,0.002,0.005,0.01,0.02,0.05,0.1,0.2]
# #pc_alphas      : [0.01]
# region         : [ [-90,90] , [120,120] ] # Lons: 120, 118
# lim_levels     : False # [950, 750] # False
# target_levels  : [3.643, 54.595, 103.317, 197.908, 379.100, 524.687, 763.404, 859.534, 912.644, 957.485] # False
# output_folder  : "./causal_links"
# #output_folder  : "./test_causal_links"
# verbosity      : 2
# output_file_pattern :
#   single: "{var_name}_{level}_lat-{lat}_lon-{lon}_{experiment}.obj"
#   concat: "{var_name}_{level}_{lat1}-{lat2}_{lon1}-{lon2}_{experiment}.obj"

# Specifications
analysis       : 'concat' # 'single': gridpoints individually; 
                          # 'concat': gridpoints contatenated into a 
                          #           single time-series; 
spcam_parents  : ['tbp','qbp','vbp','ps','solin','shflx','lhflx']
#spcam_parents  : ['tbp','ps']
#spcam_children : ['tphystnd','phq','prect','fsns','flns','fsnt','flnt']
#spcam_children : ['tphystnd','phq','fsns','flns','fsnt','flnt']
spcam_children : ['phq']
pc_alphas      : [0.001,0.002,0.005,0.01,0.02,0.05,0.1,0.2]
#pc_alphas      : [0.01]
region         : [ [-90,90] , [120,120] ] # Lons: 120, 118
lim_levels     : False # [950, 750] # False
target_levels  : [3.643] # [3.643, 54.595, 103.317, 197.908, 379.100, 524.687, 763.404, 859.534, 912.644, 957.485] # False
output_folder  : "./causal_links"
#output_folder  : "./test_causal_links"
verbosity      : 2
output_file_pattern :
  single: "{var_name}_{level}_lat-{lat}_lon-{lon}_{experiment}.obj"
  concat: "{var_name}_{level}_{lat1}-{lat2}_{lon1}-{lon2}_{experiment}.obj"Run PCMCI
/work/bd0854/b309172/conda_envs/tg38plus/lib/python3.8/site-packages/tigramite-4.2.1.5-py3.8-linux-x86_64.egg/tigramite/independence_tests/parcorr.py:94: RuntimeWarning: invalid value encountered in true_divide
  array /= array.std(axis=1).reshape(dim, 1)
Analysis: concat

2021-02-24 12:12:39.223896 Variable: phq

Load Parents (state fields)...
2021-02-24 12:12:39.224535 Gridpoint 1/64: lat=-87.86379883923263 (0), lon=120.9375 (43)
2021-02-24 12:20:44.377453 Gridpoint 2/64: lat=-85.09652698831736 (1), lon=120.9375 (43)
2021-02-24 12:22:22.511007 Gridpoint 3/64: lat=-82.31291294788628 (2), lon=120.9375 (43)
2021-02-24 12:23:42.887038 Gridpoint 4/64: lat=-79.52560657265944 (3), lon=120.9375 (43)
2021-02-24 12:25:03.633896 Gridpoint 5/64: lat=-76.73689968036831 (4), lon=120.9375 (43)
2021-02-24 12:26:28.187180 Gridpoint 6/64: lat=-73.94751515398967 (5), lon=120.9375 (43)
2021-02-24 12:27:49.014977 Gridpoint 7/64: lat=-71.15775201158732 (6), lon=120.9375 (43)
2021-02-24 12:29:09.258461 Gridpoint 8/64: lat=-68.36775610831316 (7), lon=120.9375 (43)
2021-02-24 12:30:29.674409 Gridpoint 9/64: lat=-65.57760701082782 (8), lon=120.9375 (43)
2021-02-24 12:31:50.314699 Gridpoint 10/64: lat=-62.787351798963066 (9), lon=120.9375 (43)
2021-02-24 12:33:10.398073 Gridpoint 11/64: lat=-59.9970201084913 (10), lon=120.9375 (43)
2021-02-24 12:34:32.954822 Gridpoint 12/64: lat=-57.20663152764324 (11), lon=120.9375 (43)
2021-02-24 12:36:09.884827 Gridpoint 13/64: lat=-54.4161995260862 (12), lon=120.9375 (43)
2021-02-24 12:37:39.639795 Gridpoint 14/64: lat=-51.625733674938246 (13), lon=120.9375 (43)
2021-02-24 12:39:15.303140 Gridpoint 15/64: lat=-48.83524096625058 (14), lon=120.9375 (43)
2021-02-24 12:40:50.075232 Gridpoint 16/64: lat=-46.04472663110168 (15), lon=120.9375 (43)
2021-02-24 12:42:16.825055 Gridpoint 17/64: lat=-43.25419466535094 (16), lon=120.9375 (43)
2021-02-24 12:43:43.547556 Gridpoint 18/64: lat=-40.46364817811504 (17), lon=120.9375 (43)
2021-02-24 12:45:10.447819 Gridpoint 19/64: lat=-37.67308962904533 (18), lon=120.9375 (43)
2021-02-24 12:46:29.028685 Gridpoint 20/64: lat=-34.88252099377346 (19), lon=120.9375 (43)
2021-02-24 12:47:50.028482 Gridpoint 21/64: lat=-32.091943881744015 (20), lon=120.9375 (43)
2021-02-24 12:49:08.104533 Gridpoint 22/64: lat=-29.30135962176273 (21), lon=120.9375 (43)
2021-02-24 12:50:30.210169 Gridpoint 23/64: lat=-26.510769325210994 (22), lon=120.9375 (43)
2021-02-24 12:51:49.533194 Gridpoint 24/64: lat=-23.72017393353475 (23), lon=120.9375 (43)
2021-02-24 12:53:09.052693 Gridpoint 25/64: lat=-20.929574254489513 (24), lon=120.9375 (43)
2021-02-24 12:54:30.146879 Gridpoint 26/64: lat=-18.13897099023935 (25), lon=120.9375 (43)
2021-02-24 12:55:57.982907 Gridpoint 27/64: lat=-15.348364759491494 (26), lon=120.9375 (43)
2021-02-24 12:57:16.853848 Gridpoint 28/64: lat=-12.557756115230678 (27), lon=120.9375 (43)
2021-02-24 12:58:42.598114 Gridpoint 29/64: lat=-9.76714555919557 (28), lon=120.9375 (43)
2021-02-24 13:00:03.930275 Gridpoint 30/64: lat=-6.976533553948636 (29), lon=120.9375 (43)
2021-02-24 13:01:33.880889 Gridpoint 31/64: lat=-4.185920533189154 (30), lon=120.9375 (43)
2021-02-24 13:02:57.299451 Gridpoint 32/64: lat=-1.395306910819496 (31), lon=120.9375 (43)
2021-02-24 13:04:28.622450 Gridpoint 33/64: lat=1.395306910819496 (32), lon=120.9375 (43)
2021-02-24 13:05:59.018508 Gridpoint 34/64: lat=4.185920533189154 (33), lon=120.9375 (43)
2021-02-24 13:07:28.852386 Gridpoint 35/64: lat=6.976533553948636 (34), lon=120.9375 (43)
2021-02-24 13:08:56.983751 Gridpoint 36/64: lat=9.76714555919557 (35), lon=120.9375 (43)
2021-02-24 13:10:22.511032 Gridpoint 37/64: lat=12.557756115230678 (36), lon=120.9375 (43)
2021-02-24 13:11:51.045346 Gridpoint 38/64: lat=15.348364759491494 (37), lon=120.9375 (43)
2021-02-24 13:13:19.522152 Gridpoint 39/64: lat=18.13897099023935 (38), lon=120.9375 (43)
2021-02-24 13:14:49.142578 Gridpoint 40/64: lat=20.929574254489513 (39), lon=120.9375 (43)
2021-02-24 13:16:20.941164 Gridpoint 41/64: lat=23.72017393353475 (40), lon=120.9375 (43)
2021-02-24 13:18:43.319477 Gridpoint 42/64: lat=26.510769325210994 (41), lon=120.9375 (43)
2021-02-24 13:25:01.041165 Gridpoint 43/64: lat=29.30135962176273 (42), lon=120.9375 (43)
2021-02-24 13:26:29.662420 Gridpoint 44/64: lat=32.091943881744015 (43), lon=120.9375 (43)
2021-02-24 13:28:05.396601 Gridpoint 45/64: lat=34.88252099377346 (44), lon=120.9375 (43)
2021-02-24 13:29:39.090265 Gridpoint 46/64: lat=37.67308962904533 (45), lon=120.9375 (43)
2021-02-24 13:31:12.022167 Gridpoint 47/64: lat=40.46364817811504 (46), lon=120.9375 (43)
2021-02-24 13:32:47.666340 Gridpoint 48/64: lat=43.25419466535094 (47), lon=120.9375 (43)
2021-02-24 13:34:20.315496 Gridpoint 49/64: lat=46.04472663110168 (48), lon=120.9375 (43)
2021-02-24 13:35:51.085592 Gridpoint 50/64: lat=48.83524096625058 (49), lon=120.9375 (43)
2021-02-24 13:37:22.279023 Gridpoint 51/64: lat=51.625733674938246 (50), lon=120.9375 (43)
2021-02-24 13:38:55.473968 Gridpoint 52/64: lat=54.4161995260862 (51), lon=120.9375 (43)
2021-02-24 13:40:33.407230 Gridpoint 53/64: lat=57.20663152764324 (52), lon=120.9375 (43)
2021-02-24 13:42:13.162842 Gridpoint 54/64: lat=59.9970201084913 (53), lon=120.9375 (43)
2021-02-24 13:43:55.011494 Gridpoint 55/64: lat=62.787351798963066 (54), lon=120.9375 (43)
2021-02-24 13:45:34.769689 Gridpoint 56/64: lat=65.57760701082782 (55), lon=120.9375 (43)
2021-02-24 13:47:14.136579 Gridpoint 57/64: lat=68.36775610831316 (56), lon=120.9375 (43)
2021-02-24 13:48:49.315977 Gridpoint 58/64: lat=71.15775201158732 (57), lon=120.9375 (43)
2021-02-24 13:50:28.170840 Gridpoint 59/64: lat=73.94751515398967 (58), lon=120.9375 (43)
2021-02-24 13:52:05.866353 Gridpoint 60/64: lat=76.73689968036831 (59), lon=120.9375 (43)
2021-02-24 13:53:45.553923 Gridpoint 61/64: lat=79.52560657265944 (60), lon=120.9375 (43)
2021-02-24 13:55:25.047782 Gridpoint 62/64: lat=82.31291294788628 (61), lon=120.9375 (43)
2021-02-24 13:57:04.696760 Gridpoint 63/64: lat=85.09652698831736 (62), lon=120.9375 (43)
2021-02-24 13:58:44.132089 Gridpoint 64/64: lat=87.86379883923263 (63), lon=120.9375 (43)
Parents shape:  (94, 1118144)
2021-02-24 14:00:19.140230 All parents loaded. Time: 1:47:39.915685

Load phq...
2021-02-24 14:00:19.140255 Gridpoint 1/64: lat=-87.86379883923263 (0), lon=120.9375 (43)
2021-02-24 14:00:25.354420 Gridpoint 2/64: lat=-85.09652698831736 (1), lon=120.9375 (43)
2021-02-24 14:00:28.310341 Gridpoint 3/64: lat=-82.31291294788628 (2), lon=120.9375 (43)
2021-02-24 14:00:31.138780 Gridpoint 4/64: lat=-79.52560657265944 (3), lon=120.9375 (43)
2021-02-24 14:00:33.977333 Gridpoint 5/64: lat=-76.73689968036831 (4), lon=120.9375 (43)
2021-02-24 14:00:36.898940 Gridpoint 6/64: lat=-73.94751515398967 (5), lon=120.9375 (43)
2021-02-24 14:00:39.821156 Gridpoint 7/64: lat=-71.15775201158732 (6), lon=120.9375 (43)
2021-02-24 14:00:42.674480 Gridpoint 8/64: lat=-68.36775610831316 (7), lon=120.9375 (43)
2021-02-24 14:00:45.480740 Gridpoint 9/64: lat=-65.57760701082782 (8), lon=120.9375 (43)
2021-02-24 14:00:48.254149 Gridpoint 10/64: lat=-62.787351798963066 (9), lon=120.9375 (43)
2021-02-24 14:00:51.119679 Gridpoint 11/64: lat=-59.9970201084913 (10), lon=120.9375 (43)
2021-02-24 14:00:54.029352 Gridpoint 12/64: lat=-57.20663152764324 (11), lon=120.9375 (43)
2021-02-24 14:00:56.931037 Gridpoint 13/64: lat=-54.4161995260862 (12), lon=120.9375 (43)
2021-02-24 14:00:59.826783 Gridpoint 14/64: lat=-51.625733674938246 (13), lon=120.9375 (43)
2021-02-24 14:01:02.710673 Gridpoint 15/64: lat=-48.83524096625058 (14), lon=120.9375 (43)
2021-02-24 14:01:05.370698 Gridpoint 16/64: lat=-46.04472663110168 (15), lon=120.9375 (43)
2021-02-24 14:01:08.229989 Gridpoint 17/64: lat=-43.25419466535094 (16), lon=120.9375 (43)
2021-02-24 14:01:11.111960 Gridpoint 18/64: lat=-40.46364817811504 (17), lon=120.9375 (43)
2021-02-24 14:01:14.101958 Gridpoint 19/64: lat=-37.67308962904533 (18), lon=120.9375 (43)
2021-02-24 14:01:16.838839 Gridpoint 20/64: lat=-34.88252099377346 (19), lon=120.9375 (43)
2021-02-24 14:01:19.731534 Gridpoint 21/64: lat=-32.091943881744015 (20), lon=120.9375 (43)
2021-02-24 14:01:22.616176 Gridpoint 22/64: lat=-29.30135962176273 (21), lon=120.9375 (43)
2021-02-24 14:01:25.507888 Gridpoint 23/64: lat=-26.510769325210994 (22), lon=120.9375 (43)
2021-02-24 14:01:28.389245 Gridpoint 24/64: lat=-23.72017393353475 (23), lon=120.9375 (43)
2021-02-24 14:01:31.299968 Gridpoint 25/64: lat=-20.929574254489513 (24), lon=120.9375 (43)
2021-02-24 14:01:34.269449 Gridpoint 26/64: lat=-18.13897099023935 (25), lon=120.9375 (43)
2021-02-24 14:01:37.170208 Gridpoint 27/64: lat=-15.348364759491494 (26), lon=120.9375 (43)
2021-02-24 14:01:40.102819 Gridpoint 28/64: lat=-12.557756115230678 (27), lon=120.9375 (43)
2021-02-24 14:01:46.076631 Gridpoint 29/64: lat=-9.76714555919557 (28), lon=120.9375 (43)
2021-02-24 14:01:53.532638 Gridpoint 30/64: lat=-6.976533553948636 (29), lon=120.9375 (43)
2021-02-24 14:02:00.564157 Gridpoint 31/64: lat=-4.185920533189154 (30), lon=120.9375 (43)
2021-02-24 14:02:07.843630 Gridpoint 32/64: lat=-1.395306910819496 (31), lon=120.9375 (43)
2021-02-24 14:02:15.660363 Gridpoint 33/64: lat=1.395306910819496 (32), lon=120.9375 (43)
2021-02-24 14:02:19.851095 Gridpoint 34/64: lat=4.185920533189154 (33), lon=120.9375 (43)
2021-02-24 14:02:22.746778 Gridpoint 35/64: lat=6.976533553948636 (34), lon=120.9375 (43)
2021-02-24 14:02:25.564772 Gridpoint 36/64: lat=9.76714555919557 (35), lon=120.9375 (43)
2021-02-24 14:02:28.464454 Gridpoint 37/64: lat=12.557756115230678 (36), lon=120.9375 (43)
2021-02-24 14:02:31.294942 Gridpoint 38/64: lat=15.348364759491494 (37), lon=120.9375 (43)
2021-02-24 14:02:34.156847 Gridpoint 39/64: lat=18.13897099023935 (38), lon=120.9375 (43)
2021-02-24 14:02:37.084420 Gridpoint 40/64: lat=20.929574254489513 (39), lon=120.9375 (43)
2021-02-24 14:02:39.925556 Gridpoint 41/64: lat=23.72017393353475 (40), lon=120.9375 (43)
2021-02-24 14:02:42.805989 Gridpoint 42/64: lat=26.510769325210994 (41), lon=120.9375 (43)
2021-02-24 14:02:45.697441 Gridpoint 43/64: lat=29.30135962176273 (42), lon=120.9375 (43)
2021-02-24 14:02:48.548085 Gridpoint 44/64: lat=32.091943881744015 (43), lon=120.9375 (43)
2021-02-24 14:02:51.480180 Gridpoint 45/64: lat=34.88252099377346 (44), lon=120.9375 (43)
2021-02-24 14:02:54.311501 Gridpoint 46/64: lat=37.67308962904533 (45), lon=120.9375 (43)
2021-02-24 14:02:57.053120 Gridpoint 47/64: lat=40.46364817811504 (46), lon=120.9375 (43)
2021-02-24 14:02:59.529347 Gridpoint 48/64: lat=43.25419466535094 (47), lon=120.9375 (43)
2021-02-24 14:03:02.029376 Gridpoint 49/64: lat=46.04472663110168 (48), lon=120.9375 (43)
2021-02-24 14:03:04.889462 Gridpoint 50/64: lat=48.83524096625058 (49), lon=120.9375 (43)
2021-02-24 14:03:07.817727 Gridpoint 51/64: lat=51.625733674938246 (50), lon=120.9375 (43)
2021-02-24 14:03:10.712078 Gridpoint 52/64: lat=54.4161995260862 (51), lon=120.9375 (43)
2021-02-24 14:03:13.642054 Gridpoint 53/64: lat=57.20663152764324 (52), lon=120.9375 (43)
2021-02-24 14:03:16.513795 Gridpoint 54/64: lat=59.9970201084913 (53), lon=120.9375 (43)
2021-02-24 14:03:19.219923 Gridpoint 55/64: lat=62.787351798963066 (54), lon=120.9375 (43)
2021-02-24 14:03:22.076327 Gridpoint 56/64: lat=65.57760701082782 (55), lon=120.9375 (43)
2021-02-24 14:03:24.888261 Gridpoint 57/64: lat=68.36775610831316 (56), lon=120.9375 (43)
2021-02-24 14:03:27.517586 Gridpoint 58/64: lat=71.15775201158732 (57), lon=120.9375 (43)
2021-02-24 14:03:30.450782 Gridpoint 59/64: lat=73.94751515398967 (58), lon=120.9375 (43)
2021-02-24 14:03:33.449207 Gridpoint 60/64: lat=76.73689968036831 (59), lon=120.9375 (43)
2021-02-24 14:03:36.307472 Gridpoint 61/64: lat=79.52560657265944 (60), lon=120.9375 (43)
2021-02-24 14:03:39.222345 Gridpoint 62/64: lat=82.31291294788628 (61), lon=120.9375 (43)
2021-02-24 14:03:42.094085 Gridpoint 63/64: lat=85.09652698831736 (62), lon=120.9375 (43)
2021-02-24 14:03:45.023732 Gridpoint 64/64: lat=87.86379883923263 (63), lon=120.9375 (43)
Child shape:  (1, 1118144)
2021-02-24 14:03:47.640747 Child loaded. Time: 0:03:28.500487

2021-02-24 14:03:47.659487 Finding links for phq at level 1
nans after standardizing, possibly constant array!
nans after standardizing, possibly constant array!
nans after standardizing, possibly constant array!
nans after standardizing, possibly constant array!
nans after standardizing, possibly constant array!
nans after standardizing, possibly constant array!
nans after standardizing, possibly constant array!
nans after standardizing, possibly constant array!
2021-02-24 14:03:51.764921 Links found. Time: 0:00:04.105401 Total time so far: 1:51:12.541031

Saved results into "./causal_links/phq_1_-87-87_120-120_002_train_1_year.obj"
2021-02-24 14:03:51.847400 Execution complete. Total time: 1:51:12.623495
mv: cannot create regular file `/LOG.con_phq-3_lats_lon-120-28045109.o': Permission denied

---------- Finished /var/log/slurm/spool_slurmd//job28045109/slurm_script ----------

********************************************************************************
*                                                                              *
*  This is the automated job summary provided by DKRZ.                         *
*  If you encounter problems, need assistance or have any suggestion, please   *
*  write an email to                                                           *
*                                                                              *
*  --  beratung@dkrz.de --                                                     *
*                                                                              *
*                       We hope you enjoyed the DKRZ supercomputer MISTRAL ... *
*
* JobID            : 28045109
* JobName          : con_phq-3_lats_lon-120                            
* Account          : bd1179
* User             : b309172 (25575), bd0854 (1473)                    
* Partition        : compute
* QOS              : normal
* Nodelist         : m10539 (1)                                                
* AvgCommBlocking  : 0.0000 (in [0,4] less is better)
* Submit date      : 2021-02-24T12:11:51
* Start time       : 2021-02-24T12:12:04
* End time         : 2021-02-24T14:03:58
* Elapsed time     : 01:51:54 (Timelimit=08:00:00)                     
* Command          : /mnt/lustre02/work/bd1179/b309172/analysis/usmile/
*                    causality_convection/python/causalnncam/compute_slurm_job_pipeline.sh
* WorkDir          : /mnt/lustre02/work/bd1179/b309172/analysis/usmile/
*                    causality_convection/python/causalnncam
*
* StepID | JobName      NodeHours    MaxRSS [Byte] (@task)   ReqCPUFreq [Hz]
* ------------------------------------------------------------------------------
* batch  | batch              1.9
* ------------------------------------------------------------------------------

